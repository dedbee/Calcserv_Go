# Calcserv_Go - сервис подсчета арифметических выражений.

Этот проект представляет собой асинхронный сервер для вычисления арифметических выражений. Сервер состоит из двух основных компонентов:  
  -**Оркестратор** — принимает арифметические выражения от пользователей, разбивает их на задачи и управляет их выполнением. 
  Оркестратор слушает HTTP-запросы на порту, указанном в переменной окружения PORT. Если переменная не установлена, по умолчанию используется порт 8080.  
  -**Агент** — выполняет задачи, полученные от оркестратора, и возвращает результаты.  
Проект написан на языке Go и использует HTTP для взаимодействия между компонентами.  

**Структура проекта**  
CalcServ_Go/  
├── cmd/  
│   └── main.go                *# Точка входа в приложение (оркестратор)*  
├── internal/  
│   ├── agent/                 *# Логика агента (вычислителя)*  
│   │   └── agent.go  
│   ├── application/           *# Логика приложения (оркестратора)*  
│   │   └── application.go  
│   └── orchestrator/          *# Логика оркестратора (управление задачами)*  
│       └── orchestrator.go  
├── pkg/  
│   ├── calculation/           *# Логика вычислений (арифметические операции)*  
│   │   ├── calculation.go  
│   │   ├── calculation_test.go *# Тест самого калькулятора*  
│   │   └── errors.go  
├── go.mod                     *# Файл модуля Go (зависимости)*  
└── README.md                  *# Документация проекта*  

### Инструкция по запуску  
Клонируйте репозиторий:  
`git clone https://github.com/dedbee/Calcserv_Go.git`  
Запустите проект:  
`go run cmd/main.go`  
Добавте арифметическое выражение для вычисления:  
`curl -X POST http://localhost:8080/api/v1/calculate -d '{"expression": "2 + 2"}' -H "Content-Type: application/json"`  
Этот запрос добавляет арифметическое выражение и возвращает ID задачи.  
Получите список всех выражений:  
`curl http://localhost:8080/api/v1/expressions`  
Получите выражение по его идентификатору:  
`curl --location 'http://localhost:8080/api/v1/expressions/1'`  
  
Чтобы протестировать сам калькулятор (логику вычислений) запустите тест:  
`go test pkg/calculation/calculation_test.go`  

Сервер возвращает следущие коды ответов:  
**201** (создано новое вырожение, которому присвоен собственный идентификатор (Created))  
**200** (все хорошо (OK))  
**422** (неправильное выражение (оно содержит два знака операции подряд или незакрытые скобки, деление на 0) (Unprocessable Entity))  
**404** (не найдено выражение, к которому Вы хотите обратиться (Not Found))  
**500** (ошибка сервера (Internal Server Error))  

### Примеры использования приложения.  
**1: Успешное вычисление выражения**  
Пользователь отправляет выражение:  
`curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2 + 3 * 4"
}'`  
Ответ:  
`{
    "id": 1
}`  
(Код ответа 201)  

Пользователь запрашивает результат:  
`curl --location 'http://localhost:8080/api/v1/expressions/1'`  
Ответ:  
`{
    "expression": {
        "id": 1,
        "expression": "2 + 3 * 4",
        "status": "completed",
        "result": 14
    }
}`  
(Код 200)  
  
**2: Ошибка в выражении**  
Пользователь отправляет выражение с ошибкой:  
`curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2 + abc"
}'`  
Ответ:  
`{
    "error": "Expression is not valid"
}`  
(Код 422)  
  
**3: Внутренняя ошибка сервера**  
Пользователь отправляет выражение, но сервер не может его обработать:  
`curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2 / 0"
}'`  
Ответ:  
`{
    "error": "Internal server error"
}`  
(Код 500)  

**4: Обращение к несуществующему идентификатору**  
Пользователь обращается к выражению по id, которого не существует:  
`curl --location 'http://localhost:8080/api/v1/expressions/1'`  
Ответ:  
`{
    "error": "No tasks available"
}`  
(Код 404)  
